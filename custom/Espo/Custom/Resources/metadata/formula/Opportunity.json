{
    "beforeSaveCustomScript": "//EMI amount calculation\r\n$loanAmount = amount; \r\n$tenure = cLoanTenure; \r\n$annualRate = cInterestRate;\r\n\r\n$monthlyRate = $annualRate / 12 / 100;\r\n\r\n$temp = 1 + $monthlyRate; \r\n$power = $temp; \r\n$counter = 1; \r\nwhile ($counter < $tenure) { \r\n    $power = $power * $temp; \r\n    $counter = $counter + 1; \r\n} \r\n\r\n$emi = $loanAmount * $monthlyRate * $power / ($power - 1);\r\n\r\n$emiRounded = number\\round($emi, 2);\r\n\r\ncEmiAmount = $emiRounded;\r\n\r\n//LTV Ratio calculation\r\nif (cSecurityValue > 0) {\r\n    $calc = (amount / cSecurityValue) * 100;\r\n\r\n    cLtvRatio = number\\round($calc, 2);\r\n} else {\r\n    cLtvRatio = 0;\r\n}\r\n\r\n//Total cost Calculation\r\ncTotalLoanCost= (cEmiAmount * cLoanTenure) + cProcessingFee + cInsurancePremium;\r\n\r\n//Days in pipline\r\ncDaysInPipeline = datetime\\diff(datetime\\now(),createdAt, 'days');\r\n\r\n//DTI Calculation\r\nifThen(cCalculatedDTI == null ,\r\n$grossIncome = ifThen(cApplicantMonthlyIncome > 0, cApplicantMonthlyIncome, 1);\r\n$existingEmi = ifThen(cMonthlyObligations == null, 0, cMonthlyObligations);\r\n\r\n\r\n$dtiRaw = (($existingEmi + cEmiAmount) / $grossIncome) * 100;\r\n\r\ncCalculatedDTI = number\\round($dtiRaw, 2);\r\n);\r\n\r\n//FOIR Calculation\r\nifThen(cCalculatedFOIR == null || cCalculatedFOIR == 0 ,\r\n$netIncome = ifThen(cApplicantMonthlyIncome > 0, cApplicantMonthlyIncome, 1);\r\n\r\n$foirRaw = ( cEmiAmount / $netIncome) * 100;\r\n\r\ncCalculatedFOIR = number\\round($foirRaw, 2);\r\n)"
}